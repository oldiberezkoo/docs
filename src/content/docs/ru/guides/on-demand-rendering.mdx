---
title: Рендеринг по запросу
description: Генерируйте страницы и маршруты на сервере по запросу с помощью адаптера.
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import { Steps } from '@astrojs/starlight/components';
import RecipeLinks from '~/components/RecipeLinks.astro';
import IntegrationsNav from '~/components/IntegrationsNav.astro';
import ReadMore from '~/components/ReadMore.astro';

Чтобы ваш Astro-проект отображался в браузере, его код должен быть **преобразован** в HTML.

По умолчанию Astro генерирует все страницы, маршруты и API-эндпойнты как статические файлы во время сборки. Однако вы можете обрабатывать некоторые или все маршруты на сервере в момент, когда они запрашиваются пользователем.

Страницы и маршруты с рендерингом по запросу генерируются при каждом посещении и могут быть персонализированы для каждого пользователя. Например, такая страница может показать авторизованному пользователю данные его аккаунта или отобразить актуальную информацию без пересборки всего сайта. Этот подход также известен как **рендеринг на стороне сервера (SSR)**.

## Серверные адаптеры

Чтобы рендерить страницы по запросу, вам нужно подключить **адаптер**. Адаптер позволяет Astro сгенерировать скрипт, запускающий ваш проект в конкретной **среде выполнения** (runtime) — окружении, которое выполняет код на сервере (например, Netlify, Cloudflare, Node.js).

Адаптер может понадобиться даже для полностью статического сайта, например, для использования функций [серверных островков](/ru/guides/server-islands/).

<IntegrationsNav category="adapter"/>

Astro поддерживает официальные адаптеры для [Node.js](https://nodejs.org/), [Netlify](https://www.netlify.com/), [Vercel](https://vercel.com/) и [Cloudflare](https://www.cloudflare.com/).

### Добавление адаптера

Используйте команду `astro add` для автоматической установки:

<PackageManagerTabs>
  <Fragment slot="npm">```shell npx astro add netlify ```</Fragment>
  <Fragment slot="pnpm">```shell pnpm astro add netlify ```</Fragment>
  <Fragment slot="yarn">```shell yarn astro add netlify ```</Fragment>
</PackageManagerTabs>

## Включение рендеринга по запросу

**По умолчанию весь сайт Astro генерируется заранее.** Чтобы включить рендеринг по запросу для конкретной страницы, добавьте `export const prerender = false` в начало файла:

```astro title="src/pages/on-demand.astro" ins={2}
---
export const prerender = false
---
<html>
  <!-- Этот контент будет рендериться на сервере при каждом запросе! -->
</html>
```

### Режим `'server'`

Для высокодинамичных приложений вы можете установить `output: 'server'` в конфиге. Тогда **все страницы будут рендериться на сервере по умолчанию**.

```js title="astro.config.mjs"
export default defineConfig({
  output: 'server',
  adapter: netlify(),
})
```

В этом режиме вы можете выборочно пререндерить статические страницы (например, «О нас»), добавив `export const prerender = true`.

## Возможности SSR

### Куки (Cookies)

Страницы, рендерящиеся по запросу, могут работать с куками через объект `Astro.cookies`:

```astro
---
if (Astro.cookies.has('counter')) {
  const cookie = Astro.cookies.get('counter');
  const value = cookie.number() + 1;
  Astro.cookies.set('counter', String(value));
}
---
```

### Response и Request

Вы имеете полный доступ к стандартным объектам `Astro.request` (заголовки, метод запроса) и `Astro.response` (установка статус-кодов и HTTP-заголовков).

```astro
---
// Установка 404 статуса вручную
if (!data) {
  Astro.response.status = 404;
}
---
```
